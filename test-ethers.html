<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ethers.jså…¼å®¹æ€§æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .success { color: green; }
        .error { color: red; }
        .warning { color: orange; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ ethers.jså…¼å®¹æ€§æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>åŸºæœ¬ä¿¡æ¯</h2>
        <p><strong>ethers.jsç‰ˆæœ¬:</strong> <span id="version">æ£€æµ‹ä¸­...</span></p>
        <p><strong>åŠ è½½çŠ¶æ€:</strong> <span id="loadStatus">æ£€æµ‹ä¸­...</span></p>
    </div>

    <div class="test-section">
        <h2>åŠŸèƒ½æµ‹è¯•</h2>
        <button onclick="testWalletCreation()">æµ‹è¯•é’±åŒ…åˆ›å»º</button>
        <button onclick="testRandomBytes()">æµ‹è¯•éšæœºå­—èŠ‚ç”Ÿæˆ</button>
        <button onclick="testAddressValidation()">æµ‹è¯•åœ°å€éªŒè¯</button>
        <button onclick="testAllFunctions()">è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
    </div>

    <div class="test-section">
        <h2>æµ‹è¯•ç»“æœ</h2>
        <div id="testResults"></div>
    </div>

    <div class="test-section">
        <h2>å…¼å®¹æ€§å»ºè®®</h2>
        <div id="compatibilityAdvice"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/ethers@6.8.1/dist/ethers.umd.min.js"></script>
    <script>
        let testResults = [];

        // æ£€æŸ¥ethers.jsåŠ è½½çŠ¶æ€
        function checkEthersLoad() {
            const versionSpan = document.getElementById('version');
            const loadStatusSpan = document.getElementById('loadStatus');
            
            if (typeof ethers === 'undefined') {
                versionSpan.textContent = 'æœªåŠ è½½';
                loadStatusSpan.textContent = 'âŒ å¤±è´¥';
                loadStatusSpan.className = 'error';
                return false;
            }
            
            const version = ethers.version || 'æœªçŸ¥ç‰ˆæœ¬';
            versionSpan.textContent = version;
            loadStatusSpan.textContent = 'âœ… æˆåŠŸ';
            loadStatusSpan.className = 'success';
            return true;
        }

        // æµ‹è¯•é’±åŒ…åˆ›å»º
        function testWalletCreation() {
            try {
                const wallet = ethers.Wallet.createRandom();
                const result = {
                    test: 'é’±åŒ…åˆ›å»º',
                    status: 'âœ… æˆåŠŸ',
                    details: `åœ°å€: ${wallet.address.substring(0, 20)}...`
                };
                addTestResult(result);
                return true;
            } catch (error) {
                const result = {
                    test: 'é’±åŒ…åˆ›å»º',
                    status: 'âŒ å¤±è´¥',
                    details: error.message
                };
                addTestResult(result);
                return false;
            }
        }

        // æµ‹è¯•éšæœºå­—èŠ‚ç”Ÿæˆ
        function testRandomBytes() {
            try {
                const bytes = ethers.randomBytes(32);
                const result = {
                    test: 'éšæœºå­—èŠ‚ç”Ÿæˆ',
                    status: 'âœ… æˆåŠŸ',
                    details: `ç”Ÿæˆäº† ${bytes.length} å­—èŠ‚`
                };
                addTestResult(result);
                return true;
            } catch (error) {
                const result = {
                    test: 'éšæœºå­—èŠ‚ç”Ÿæˆ',
                    status: 'âŒ å¤±è´¥',
                    details: error.message
                };
                addTestResult(result);
                return false;
            }
        }

        // æµ‹è¯•åœ°å€éªŒè¯
        function testAddressValidation() {
            try {
                const testAddress = '0x742d35Cc6634C0532925a3b8D4C9db96C4b4d8b6';
                const isValid = ethers.isAddress(testAddress);
                const result = {
                    test: 'åœ°å€éªŒè¯',
                    status: 'âœ… æˆåŠŸ',
                    details: `æµ‹è¯•åœ°å€ ${isValid ? 'æœ‰æ•ˆ' : 'æ— æ•ˆ'}`
                };
                addTestResult(result);
                return true;
            } catch (error) {
                const result = {
                    test: 'åœ°å€éªŒè¯',
                    status: 'âŒ å¤±è´¥',
                    details: error.message
                };
                addTestResult(result);
                return false;
            }
        }

        // è¿è¡Œæ‰€æœ‰æµ‹è¯•
        function testAllFunctions() {
            testResults = [];
            document.getElementById('testResults').innerHTML = '';
            
            const tests = [
                testWalletCreation,
                testRandomBytes,
                testAddressValidation
            ];
            
            let passedTests = 0;
            tests.forEach(test => {
                if (test()) {
                    passedTests++;
                }
            });
            
            // ç”Ÿæˆå…¼å®¹æ€§å»ºè®®
            generateCompatibilityAdvice(passedTests, tests.length);
        }

        // æ·»åŠ æµ‹è¯•ç»“æœ
        function addTestResult(result) {
            testResults.push(result);
            const resultsDiv = document.getElementById('testResults');
            
            const resultElement = document.createElement('div');
            resultElement.innerHTML = `
                <h3>${result.test}</h3>
                <p><strong>çŠ¶æ€:</strong> <span class="${result.status.includes('æˆåŠŸ') ? 'success' : 'error'}">${result.status}</span></p>
                <p><strong>è¯¦æƒ…:</strong> ${result.details}</p>
            `;
            
            resultsDiv.appendChild(resultElement);
        }

        // ç”Ÿæˆå…¼å®¹æ€§å»ºè®®
        function generateCompatibilityAdvice(passedTests, totalTests) {
            const adviceDiv = document.getElementById('compatibilityAdvice');
            
            if (passedTests === totalTests) {
                adviceDiv.innerHTML = `
                    <div class="success">
                        <h3>ğŸ‰ å®Œå…¨å…¼å®¹</h3>
                        <p>æ‰€æœ‰æµ‹è¯•éƒ½é€šè¿‡äº†ï¼ethers.jså·¥ä½œæ­£å¸¸ï¼ŒMPCæ¼”ç¤ºç³»ç»Ÿåº”è¯¥å¯ä»¥æ­£å¸¸è¿è¡Œã€‚</p>
                    </div>
                `;
            } else if (passedTests > 0) {
                adviceDiv.innerHTML = `
                    <div class="warning">
                        <h3>âš ï¸ éƒ¨åˆ†å…¼å®¹</h3>
                        <p>${passedTests}/${totalTests} ä¸ªæµ‹è¯•é€šè¿‡ã€‚æŸäº›åŠŸèƒ½å¯èƒ½æ— æ³•æ­£å¸¸å·¥ä½œã€‚</p>
                        <p>å»ºè®®æ£€æŸ¥ethers.jsç‰ˆæœ¬æˆ–ä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆã€‚</p>
                    </div>
                `;
            } else {
                adviceDiv.innerHTML = `
                    <div class="error">
                        <h3>âŒ ä¸å…¼å®¹</h3>
                        <p>æ‰€æœ‰æµ‹è¯•éƒ½å¤±è´¥äº†ï¼ethers.jså¯èƒ½æ²¡æœ‰æ­£ç¡®åŠ è½½æˆ–ç‰ˆæœ¬ä¸å…¼å®¹ã€‚</p>
                        <p>å»ºè®®ï¼š</p>
                        <ul>
                            <li>æ£€æŸ¥ç½‘ç»œè¿æ¥</li>
                            <li>åˆ·æ–°é¡µé¢é‡è¯•</li>
                            <li>ä½¿ç”¨ä¸åŒçš„æµè§ˆå™¨</li>
                            <li>æ£€æŸ¥ethers.jsç‰ˆæœ¬</li>
                        </ul>
                    </div>
                `;
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåè¿è¡Œæ£€æŸ¥
        document.addEventListener('DOMContentLoaded', function() {
            // ç­‰å¾…ethers.jsåŠ è½½
            setTimeout(() => {
                checkEthersLoad();
                if (typeof ethers !== 'undefined') {
                    testAllFunctions();
                }
            }, 1000);
        });
    </script>
</body>
</html> 